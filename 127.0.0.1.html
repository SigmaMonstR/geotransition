
<!-- saved from url=(0022)http://127.0.0.1:8080/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <style>
    path {
      fill: #e3e3e3;
      stroke-width: 1px;
      stroke: #666;
    }

    circle {
      stroke: none;
      fill: #fc0;
    }

    .added {
      fill: #f0f;
    }
  </style>
</head>
<body>
    <svg width="960" height="500"><path d="M37.18090471646099,29.18569533832699L36.103715965348265,29.727495328041805L38.917225594246766,31.221514398906148L40.60449148656208,31.68204313739584L39.64528349869393,32.102416568542544L41.00993732278996,32.67051746404993L42.263452956754364,32.47344064465743L44.69429228998248,33.78120651157638L43.80405004841826,34.00939634334038L46.087446026380945,35.201491248881496L46.69607563515122,36.93262496690468L45.51447698190867,36.98986380312039L45.010183945576614,36.46077622419652L44.13972495561245,36.51933716199147L44.56848348441105,37.995324377364845L44.7981364032101,37.89676748370355L44.46232938961047,37.57216217834916L45.96678136241753,37.56725648152927L47.346764162824456,40.739168432050086L46.495250142535475,40.59955414195446L46.14133698364582,41.626150955466315L45.74682062309196,41.92135779018567L44.94874981533801,42.01692851007606L45.23395793121046,42.376348362547006L45.97069589639331,43.128424767244276L46.058060756576765,43.6831925868905L45.37860543478217,44.177601313029754L45.87687913252684,44.74409004417405L42.22795921342997,45.00132102965044L42.23924672884713,45.53375655242746L45.71476965007853,45.84793795349049L46.213819184118634,46.32803490122819L45.59255000532497,46.62889749668131L45.59255000532497,47.39278523274763L45.00672585395375,47.55078504038102L44.58371464480957,47.239305443879054L34.2624090383185,48.27623149752269L33.642215332411304,48.12003791042454L30.138244046606353,44.44690826223528L30.45038044444657,44.32897910799424L31.34829456653636,44.52030621338374L31.597076452113164,45.172775895244506L32.44293196136329,44.99040506650445L31.14850857922375,43.21502961925583L30.293972619648937,43.40094734086676L30.667640173242305,44.027321773826735L29.97917571969487,44.403757368967035L29.175252477562697,43.06438594266937L26.567445208628737,40.65536184011275L26.68805825510924,38.61230668323907L27.77716746291561,38.54015510906313L27.79024230514613,39.01452369098027L28.701917540047887,38.989930605261726L28.965889052636204,36.79914388693144L28.646533470685455,36.814381806397435L28.597219443626095,37.26459719356304L28.045806222178562,37.3494204909678L28.39242162525713,35.60107382114901L28.078006403137223,35.42727126036487L27.851197649417117,35.475619724865325L27.82349450569656,35.88252773894793L27.864257804449196,40.88240443638888L36.14424735163943,49.903137364575805L40.858470042674355,52.15415343657366L48.928468163178465,53.76773552787631L66.83606657272591,56.83282800729621L93.37911591593503,61.64765741193274L93.16618005118593,62.222777534400706L97.14357740244171,62.8640200575977L97.49117584102989,62.37513724364696L103.98744222647161,63.61454660145261L109.78612981990788,61.24423991103687L109.58593209957317,58.66969852210861L94.14152970109366,50.59128499852947L80.20901094813915,41.157961786812244L76.05604099206272,38.45871329645125L79.2024160136434,37.0627439445216L80.16872680413672,37.681126999083475L81.60058227725321,36.876906190692296L78.77157769637954,35.04377537045669L77.31910047794379,35.60671847960816L77.60219072819493,35.91429852168408L74.55313663522318,37.1096273717993L74.17309303276157,36.47441890451899L71.49907975423213,35.34119498413358L68.12543024219762,34.05564884286509L66.54779923829099,33.57803741177773L65.35642393160302,32.79798135980142L59.41691449947548,30.20592099936522L58.545497585052374,29.576284180690717L55.738969513419434,29.102798013786582L54.70905879152262,29.323050693421223L53.317974202162475,28.42415327379093L47.01684673302813,24.818153606658257L47.85033401627237,24.459594057076103L44.628747927452004,22.673434830433827L43.797541171231764,23.103660629214072L42.0955214813937,22.748581093780246L39.5523233769214,22.380610697554914L37.64753657288588,22.226463819806554L32.743788505039,23.981975480693798L32.15472208856054,24.7127546678645L32.658242002626274,26.57044286483319L37.403510772234,29.088227289270723Z"></path><g><circle r="2" cx="37.18090471646099" cy="29.18569533832699" class="added"></circle><circle r="2" cx="36.103715965348265" cy="29.727495328041805" class="added"></circle><circle r="2" cx="38.917225594246766" cy="31.221514398906148"></circle><circle r="2" cx="40.60449148656208" cy="31.68204313739584"></circle><circle r="2" cx="39.64528349869393" cy="32.102416568542544" class="added"></circle><circle r="2" cx="41.00993732278996" cy="32.67051746404993"></circle><circle r="2" cx="42.263452956754364" cy="32.47344064465743" class="added"></circle><circle r="2" cx="44.69429228998248" cy="33.78120651157638" class="added"></circle><circle r="2" cx="43.80405004841826" cy="34.00939634334038" class="added"></circle><circle r="2" cx="46.087446026380945" cy="35.201491248881496"></circle><circle r="2" cx="46.69607563515122" cy="36.93262496690468" class="added"></circle><circle r="2" cx="45.51447698190867" cy="36.98986380312039" class="added"></circle><circle r="2" cx="45.010183945576614" cy="36.46077622419652"></circle><circle r="2" cx="44.13972495561245" cy="36.51933716199147" class="added"></circle><circle r="2" cx="44.56848348441105" cy="37.995324377364845" class="added"></circle><circle r="2" cx="44.7981364032101" cy="37.89676748370355" class="added"></circle><circle r="2" cx="44.46232938961047" cy="37.57216217834916" class="added"></circle><circle r="2" cx="45.96678136241753" cy="37.56725648152927"></circle><circle r="2" cx="47.346764162824456" cy="40.739168432050086" class="added"></circle><circle r="2" cx="46.495250142535475" cy="40.59955414195446"></circle><circle r="2" cx="46.14133698364582" cy="41.626150955466315" class="added"></circle><circle r="2" cx="45.74682062309196" cy="41.92135779018567"></circle><circle r="2" cx="44.94874981533801" cy="42.01692851007606"></circle><circle r="2" cx="45.23395793121046" cy="42.376348362547006" class="added"></circle><circle r="2" cx="45.97069589639331" cy="43.128424767244276"></circle><circle r="2" cx="46.058060756576765" cy="43.6831925868905" class="added"></circle><circle r="2" cx="45.37860543478217" cy="44.177601313029754"></circle><circle r="2" cx="45.87687913252684" cy="44.74409004417405" class="added"></circle><circle r="2" cx="42.22795921342997" cy="45.00132102965044" class="added"></circle><circle r="2" cx="42.23924672884713" cy="45.53375655242746"></circle><circle r="2" cx="45.71476965007853" cy="45.84793795349049"></circle><circle r="2" cx="46.213819184118634" cy="46.32803490122819" class="added"></circle><circle r="2" cx="45.59255000532497" cy="46.62889749668131"></circle><circle r="2" cx="45.59255000532497" cy="47.39278523274763"></circle><circle r="2" cx="45.00672585395375" cy="47.55078504038102" class="added"></circle><circle r="2" cx="44.58371464480957" cy="47.239305443879054" class="added"></circle><circle r="2" cx="34.2624090383185" cy="48.27623149752269"></circle><circle r="2" cx="33.642215332411304" cy="48.12003791042454"></circle><circle r="2" cx="30.138244046606353" cy="44.44690826223528" class="added"></circle><circle r="2" cx="30.45038044444657" cy="44.32897910799424"></circle><circle r="2" cx="31.34829456653636" cy="44.52030621338374" class="added"></circle><circle r="2" cx="31.597076452113164" cy="45.172775895244506"></circle><circle r="2" cx="32.44293196136329" cy="44.99040506650445" class="added"></circle><circle r="2" cx="31.14850857922375" cy="43.21502961925583" class="added"></circle><circle r="2" cx="30.293972619648937" cy="43.40094734086676"></circle><circle r="2" cx="30.667640173242305" cy="44.027321773826735"></circle><circle r="2" cx="29.97917571969487" cy="44.403757368967035"></circle><circle r="2" cx="29.175252477562697" cy="43.06438594266937" class="added"></circle><circle r="2" cx="26.567445208628737" cy="40.65536184011275"></circle><circle r="2" cx="26.68805825510924" cy="38.61230668323907"></circle><circle r="2" cx="27.77716746291561" cy="38.54015510906313" class="added"></circle><circle r="2" cx="27.79024230514613" cy="39.01452369098027"></circle><circle r="2" cx="28.701917540047887" cy="38.989930605261726"></circle><circle r="2" cx="28.965889052636204" cy="36.79914388693144" class="added"></circle><circle r="2" cx="28.646533470685455" cy="36.814381806397435" class="added"></circle><circle r="2" cx="28.597219443626095" cy="37.26459719356304"></circle><circle r="2" cx="28.045806222178562" cy="37.3494204909678" class="added"></circle><circle r="2" cx="28.39242162525713" cy="35.60107382114901" class="added"></circle><circle r="2" cx="28.078006403137223" cy="35.42727126036487" class="added"></circle><circle r="2" cx="27.851197649417117" cy="35.475619724865325" class="added"></circle><circle r="2" cx="27.82349450569656" cy="35.88252773894793" class="added"></circle><circle r="2" cx="27.864257804449196" cy="40.88240443638888"></circle><circle r="2" cx="36.14424735163943" cy="49.903137364575805" class="added"></circle><circle r="2" cx="40.858470042674355" cy="52.15415343657366" class="added"></circle><circle r="2" cx="48.928468163178465" cy="53.76773552787631"></circle><circle r="2" cx="66.83606657272591" cy="56.83282800729621" class="added"></circle><circle r="2" cx="93.37911591593503" cy="61.64765741193274" class="added"></circle><circle r="2" cx="93.16618005118593" cy="62.222777534400706"></circle><circle r="2" cx="97.14357740244171" cy="62.8640200575977" class="added"></circle><circle r="2" cx="97.49117584102989" cy="62.37513724364696" class="added"></circle><circle r="2" cx="103.98744222647161" cy="63.61454660145261"></circle><circle r="2" cx="109.78612981990788" cy="61.24423991103687" class="added"></circle><circle r="2" cx="109.58593209957317" cy="58.66969852210861"></circle><circle r="2" cx="94.14152970109366" cy="50.59128499852947" class="added"></circle><circle r="2" cx="80.20901094813915" cy="41.157961786812244"></circle><circle r="2" cx="76.05604099206272" cy="38.45871329645125" class="added"></circle><circle r="2" cx="79.2024160136434" cy="37.0627439445216"></circle><circle r="2" cx="80.16872680413672" cy="37.681126999083475" class="added"></circle><circle r="2" cx="81.60058227725321" cy="36.876906190692296" class="added"></circle><circle r="2" cx="78.77157769637954" cy="35.04377537045669" class="added"></circle><circle r="2" cx="77.31910047794379" cy="35.60671847960816"></circle><circle r="2" cx="77.60219072819493" cy="35.91429852168408" class="added"></circle><circle r="2" cx="74.55313663522318" cy="37.1096273717993"></circle><circle r="2" cx="74.17309303276157" cy="36.47441890451899"></circle><circle r="2" cx="71.49907975423213" cy="35.34119498413358" class="added"></circle><circle r="2" cx="68.12543024219762" cy="34.05564884286509"></circle><circle r="2" cx="66.54779923829099" cy="33.57803741177773" class="added"></circle><circle r="2" cx="65.35642393160302" cy="32.79798135980142"></circle><circle r="2" cx="59.41691449947548" cy="30.20592099936522" class="added"></circle><circle r="2" cx="58.545497585052374" cy="29.576284180690717"></circle><circle r="2" cx="55.738969513419434" cy="29.102798013786582"></circle><circle r="2" cx="54.70905879152262" cy="29.323050693421223" class="added"></circle><circle r="2" cx="53.317974202162475" cy="28.42415327379093" class="added"></circle><circle r="2" cx="47.01684673302813" cy="24.818153606658257"></circle><circle r="2" cx="47.85033401627237" cy="24.459594057076103"></circle><circle r="2" cx="44.628747927452004" cy="22.673434830433827" class="added"></circle><circle r="2" cx="43.797541171231764" cy="23.103660629214072"></circle><circle r="2" cx="42.0955214813937" cy="22.748581093780246" class="added"></circle><circle r="2" cx="39.5523233769214" cy="22.380610697554914"></circle><circle r="2" cx="37.64753657288588" cy="22.226463819806554" class="added"></circle><circle r="2" cx="32.743788505039" cy="23.981975480693798"></circle><circle r="2" cx="32.15472208856054" cy="24.7127546678645"></circle><circle r="2" cx="32.658242002626274" cy="26.57044286483319" class="added"></circle><circle r="2" cx="37.403510772234" cy="29.088227289270723"></circle></g></svg>

    <script src="./127.0.0.1_files/d3.min.js"></script>
    <script src="./127.0.0.1_files/topojson.min.js"></script>
    <script src="./127.0.0.1_files/jquery.min.js"></script>
<script>

 
  var svg = d3.select("svg"),
      path = svg.append("path"),
      circles = svg.append("g");

  d3.json("total.json", function(err, topo){

    
    var states = topojson.feature(topo, topo.objects.states).features.map(function(d){
      return d.geometry.coordinates[0];
    });

    d3.shuffle(states);

    draw();

    function draw() {

      var a = states[0].slice(0),
          b = states[1].slice(0);

      // Same number of points on each ring
      if (a.length < b.length) {
        addPoints(a, b.length - a.length);
      } else if (b.length < a.length) {
        addPoints(b, a.length - b.length);
      }

      // Pick optimal winding
      a = wind(a, b);

      path.attr("d", join(a));

      // Redraw points
      circles.datum(a)
        .call(updateCircles);

      // Morph
      var t = d3.transition()
        .duration(800);

      path.transition(t)
        .on("end", function(){
          states.push(states.shift());
          setTimeout(draw, 100);
        })
        .attr("d", join(b));

      circles.selectAll("circle").data(b)
        .transition(t)
        .attr("cx",function(d){
          return d[0];
        })
        .attr("cy",function(d){
          return d[1];
        });

    }

  });

  function updateCircles(sel) {

    var circles = sel.selectAll("circle")
      .data(function(d){ return d; });

    var merged = circles.enter()
      .append("circle")
      .attr("r", 2)
      .merge(circles);

    merged.classed("added", function(d){
        return d.added;
      })
      .attr("cx",function(d){
        return d[0];
      })
      .attr("cy",function(d){
        return d[1];
      });

    circles.exit().remove();

  }

  function addPoints(ring, numPoints) {

    var desiredLength = ring.length + numPoints,
        step = d3.polygonLength(ring) / numPoints;

    var i = 0,
        cursor = 0,
        insertAt = step / 2;

    do {

      var a = ring[i],
          b = ring[(i + 1) % ring.length];

      var segment = distanceBetween(a, b);

      if (insertAt <= cursor + segment) {
        ring.splice(i + 1, 0, pointBetween(a, b, (insertAt - cursor) / segment));
        insertAt += step;
        continue;
      }

      cursor += segment;
      i++;

    } while (ring.length < desiredLength);

  }

  function pointBetween(a, b, pct) {

    var point = [
      a[0] + (b[0] - a[0]) * pct,
      a[1] + (b[1] - a[1]) * pct
    ];

    point.added = true;
    return point;

  }

  function distanceBetween(a, b) {
    return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2));
  }

  function join(d) {
    return "M" + d.join("L") + "Z";
  }

  function wind(ring, vs) {

    var len = ring.length,
        min = Infinity,
        bestOffset,
        sum;

    for (var offset = 0, len = ring.length; offset < len; offset++) {

      var sum = d3.sum(vs.map(function(p, i){
        var distance = distanceBetween(ring[(offset + i) % len], p);
        return distance * distance;
      }));

      if (sum < min) {
        min = sum;
        bestOffset = offset;
      }

    }

    return ring.slice(bestOffset).concat(ring.slice(0, bestOffset));

  }

</script>
</body></html>